<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content>
    <meta name="author" content>
    <title>Please sign in</title>
    <meta charset="UTF-8">
    <title>cars</title>
    <link rel="stylesheet" href="https://snipp.ru/cdn/chosen/1.8.7/chosen.min.css">
    <script src="https://snipp.ru/cdn/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://snipp.ru/cdn/chosen/1.8.7/chosen.jquery.min.js"></script>

    <script th:inline="javascript">

$(document).ready(function(){

        var minutesLabel = document.getElementById("minutes");
        var secondsLabel = document.getElementById("seconds");
        var starttime = [[${starttime}]];
        var cost = $("#cost");
        console.log(sessionStorage.visitCount)
<!--        if (sessionStorage.visitCount <1 ) {-->
<!--          sessionStorage.totalSeconds = 0;-->
<!--          sessionStorage.totalMinutes = 0;-->
<!--            clearInterval(a);-->
<!--            return;-->
<!--        }-->

        if (sessionStorage.length !== 0 ) {
            console.log(sessionStorage.totalSeconds);
        } else {
          sessionStorage.totalSeconds = 0;
          sessionStorage.totalMinutes = 0;
          var now = new Date();
          sessionStorage.currDate = now.getTime();

        }

        var totalSeconds = sessionStorage.totalSeconds;
        var a = setInterval(setTime, 1000);
<!--        var totalSeconds = 0;-->
<!--        setInterval(setTime, 1000);-->



        function setTime()
        {
            let newDate = new Date();
<!--            console.log(newDate)-->
<!--            console.log(Math.abs((newDate.getTime() - sessionStorage.currDate ) / 1000) )-->
            sessionStorage.totalSeconds = Math.ceil(Math.abs((newDate.getTime() - sessionStorage.currDate ) / 1000));
            secondsLabel.innerHTML = pad(sessionStorage.totalSeconds%60);
            minutesLabel.innerHTML = pad(parseInt(sessionStorage.totalSeconds/60));
<!--            sessionStorage.totalSeconds = totalSeconds;-->
            sessionStorage.totalMinutes = parseInt(totalSeconds/60);
            cost.attr("value", Number(parseFloat(cost.val()) + 0.2).toFixed(1));
<!--            console.log(cost.val());-->
        }

        function pad(val)
        {
            var valString = val + "";
            if(valString.length < 2)
            {
                return "0" + valString;
            }
            else
            {
                return valString;
            }
        }

        $("#stop" ).click(function() {

          clearInterval(a);
          sessionStorage.clear();
        });

        $("#submit" ).click(function() {

<!--          $(window).unbind("beforeunload");-->
          sessionStorage.visitCount = 1;
          clearInterval(a);
          sessionStorage.clear();
        });

        $("#submit").submit(function(e) {

            e.preventDefault();

        });

<!--        $(window).bind('beforeunload', function () {-->
<!--            console.log("cringe")-->
<!--        });-->




    });




    </script>

</head>


<body>

<div>
    <h1>Завершение заказа</h1>

    <div class="container">
        <form class="form-signin" id="form" role="form" th:action="@{/home/finishorder}" th:method="post">

            <div class="timer">
                <label id="minutes" >00</label>
                <label id="colon">:</label>
                <label id="seconds">00</label>
            </div>

            <option value=""></option>


            <div >
                <input type="text" th:name="cost" id="cost" th:value="1" readonly>
            </div>

            <input type="submit" name="Завершить" id="submit">
        </form>
        <button id="stop">Отстановить</button>

    </div>

</div>


</body>
</html>